-- Select all pre/post/proxy literacy assessment and merge with all pre/post/proxy ELA CG data.

-- USE THIS VERSION OF ELA CG QUERY SINCE THIS REMOVED THE RPT_SCHOOL_GRADE LINKAGES TO SIMPLIFY QUERY.

SELECT prepost2.*, letterchange.LetterGradeChange_general AS MY_Change
FROM
(SELECT dbo_RPT_STUDENT_MAIN.SITE_NAME, dbo_RPT_STUDENT_MAIN.SCHOOL_NAME, dbo_RPT_STUDENT_MAIN.GRADE_ID, dbo_RPT_STUDENT_MAIN.DIPLOMAS_NOW_SCHOOL, prepost.*, MY_PROXY_ELA_CG.*,
IIf([prepost].[POST_ELA_FREQ] IS NULL AND ([prepost].[PRE_ELA_FREQ] < [MY_PROXY_ELA_CG].[INTERVAL] OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative'),[MY_PROXY_ELA_CG].[INTERVAL],[prepost].[POST_ELA_FREQ]) AS MY_ELA_FREQ,
IIf([prepost].[POST_ELA_FREQ] IS NULL AND ([prepost].[PRE_ELA_FREQ] < [MY_PROXY_ELA_CG].[INTERVAL] OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative'),[MY_PROXY_ELA_CG].[SCALE_LOCAL],[prepost].[POST_ELA_TRACK]) AS MY_ELA_TRACK,
IIf([prepost].[POST_ELA_FREQ] IS NULL AND ([prepost].[PRE_ELA_FREQ] < [MY_PROXY_ELA_CG].[INTERVAL] OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative'),[MY_PROXY_ELA_CG].[CG_LETTER_VIEW],[prepost].[POST_LETTER_VIEW]) AS MY_LETTER_VIEW,
IIf([prepost].[POST_ELA_FREQ] IS NULL AND ([prepost].[PRE_ELA_FREQ] < [MY_PROXY_ELA_CG].[INTERVAL] OR prepost.PRE_ELA_FREQ LIKE 'ELA/Literacy PrYr/Cumulative'),[MY_PROXY_ELA_CG].[CG_LETTER_VIEW_ALL],[prepost].[POST_CG_LETTER_SCALE_ALL]) AS MY_CG_LETTER_SCALE_ALL,
IIf(prepost.PRE_LETTER_VIEW IS NOT NULL AND MY_LETTER_VIEW IS NOT NULL,prepost.PRE_LETTER_VIEW & ' to ' & MY_LETTER_VIEW,'Insufficient Data') AS MY_LETTERGRADE_CHANGE_ACTUAL,
IIf(prepost.PRE_ELA_TRACK IS NOT NULL AND MY_ELA_TRACK IS NOT NULL,[prepost].[PRE_ELA_TRACK] & " to " & MY_ELA_TRACK,"Insufficient Data") AS MY_PERF_CHANGE
FROM dbo_RPT_STUDENT_MAIN INNER JOIN (dbo_EVAL_ELA AS prepost LEFT JOIN
(SELECT allELA1.* FROM dbo_RPT_PERFORMANCE_LEVEL AS allELA1 LEFT JOIN dbo_RPT_PERFORMANCE_LEVEL AS allELA2 ON (allELA1.STUDENT_ID = allELA2.STUDENT_ID AND allELA1.INDICATOR_DESC = allELA2.INDICATOR_DESC AND allELA1.FREQ_SORT < allELA2.FREQ_SORT AND allELA1.SKILL_DESCRIPTION LIKE 'ELA Course Grade' AND ISNULL(allELA1.Tag)) WHERE allELA2.STUDENT_ID IS NULL)
AS MY_PROXY_ELA_CG ON (prepost.STUDENT_ID = MY_PROXY_ELA_CG.STUDENT_ID)) ON (dbo_RPT_STUDENT_MAIN.STUDENT_ID = prepost.STUDENT_ID))
AS prepost2 LEFT JOIN dbo_RPT_LETTER_CHANGE_DEGREE AS letterchange
ON (prepost2.MY_LETTERGRADE_CHANGE_ACTUAL LIKE letterchange.LetterGrade_Change_Actual)
ORDER BY dbo_RPT_STUDENT_MAIN.SITE_NAME, dbo_RPT_STUDENT_MAIN.SCHOOL_NAME,dbo_RPT_STUDENT_MAIN.GRADE_ID,prepost.STUDENT_ID;

-- QUERY SYNTAX (BASED ON ELA CG/LIT ASSESS QUERIES):

SELECT ppp_LITAssess.dbo_RPT_STUDENT_MAIN.SITE_NAME, ppp_LITAssess.dbo_RPT_STUDENT_MAIN.SCHOOL_NAME, ppp_LITAssess.dbo_RPT_STUDENT_MAIN.GRADE_ID, ppp_LITAssess.DIPLOMAS_NOW_SCHOOL, ppp_LITAssess.prepost.STUDENT_ID, ppp_LITAssess.prepost.SCHOOL_ID, ppp_LITAssess.TTL_TIME, ppp_LITAssess.ENROLLED_DAYS, ppp_LITAssess.ENROLLED_DAYS_CATEGORIES, ppp_LITAssess.SITE_DOSAGE_GOAL, ppp_LITAssess.STATUS_SITE_DOSAGE_GOAL, ppp_LITAssess.Attendance_IA, ppp_LITAssess.ELA_IA, ppp_LITAssess.Math_IA, ppp_LITAssess.Behavior_IA, ppp_LITAssess.B_RULE_VAL1, ppp_LITAssess.B_RULE_VAL2, ppp_LITAssess.B_RULE_VAL3, ppp_LITAssess.B_RULE_VAL4, ppp_LITAssess.GRADE_ID_RECODE, ppp_LITAssess.DN_SCHOOL_BY_GRADE, ppp_LITAssess.MY_MET_Q3_DOSAGE, ppp_LITAssess.MY_IN_IOG_GRADE_RANGE, ppp_LITAssess.PRE_DATE, ppp_LITAssess.PRE_DESC, ppp_LITAssess.PRE_VALUE_NUM, ppp_LITAssess.PRE_TRACK, ppp_LITAssess.PRE_TRACK_EVAL, ppp_LITAssess.MY_PERF_DATE, ppp_LITAssess.MY_VALUE_NUM, ppp_LITAssess.MY_TRACK, ppp_LITAssess.MY_TRACK_EVAL, ppp_LITAssess.MY_RAWCHANGE_DEGREE, ppp_LITAssess.MY_PERFORMANCECHANGE_LOCAL, ppp_LITAssess.MY_PERFORMANCECHANGE_NORMALIZED, ppp_ELA_CG.PRE_ELA_FREQ, ppp_ELA_CG.PRE_ELA_TRACK, ppp_ELA_CG.PRE_LETTER_VIEW, ppp_ELA_CG.PRE_CG_LETTER_SCALE_ALL, ppp_ELA_CG.MY_ELA_FREQ, ppp_ELA_CG.MY_ELA_TRACK, ppp_ELA_CG.MY_LETTER_VIEW, ppp_ELA_CG.MY_CG_LETTER_SCALE_ALL, ppp_ELA_CG.MY_LETTERGRADE_CHANGE_ACTUAL, ppp_ELA_CG.MY_Change, ppp_ELA_CG.MY_PERF_CHANGE,
IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.PRE_ELA_TRACK LIKE 'SLIDING'),'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',IIF((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'ON TRACK'),'Off-Track/Sliding in Assessments, On-Track in ELA CG',IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.PRE_ELA_TRACK LIKE 'SLIDING'),'On-Track in Assessments, Off-Track/Sliding in ELA CG',IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'ON TRACK'),'On-Track in Assessments, On-Track in ELA CG',NULL)))) AS MY_LIT_ELA_PRE_COMPARE,
IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.PRE_ELA_TRACK LIKE 'SLIDING'),4,IIF((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'ON TRACK'),3,IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.PRE_ELA_TRACK LIKE 'SLIDING'),2,IIf((ppp_LITAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.PRE_ELA_TRACK LIKE 'ON TRACK'),1,NULL)))) AS MY_LIT_ELA_PRE_COMPARE_NUM,
IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.MY_ELA_TRACK LIKE 'SLIDING'),'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',IIF((ppp_LITAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'ON TRACK'),'Off-Track/Sliding in Assessments, On-Track in ELA CG',IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.MY_ELA_TRACK LIKE 'SLIDING'),'On-Track in Assessments, Off-Track/Sliding in ELA CG',IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'ON TRACK'),'On-Track in Assessments, On-Track in ELA CG',NULL)))) AS MY_LIT_ELA_POST_COMPARE,
IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.MY_ELA_TRACK LIKE 'SLIDING'),4,IIF((ppp_LITAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_LITAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'ON TRACK'),3,IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'OFF TRACK' OR ppp_ELA_CG.MY_ELA_TRACK LIKE 'SLIDING'),2,IIf((ppp_LITAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_ELA_CG.MY_ELA_TRACK LIKE 'ON TRACK'),1,NULL)))) AS MY_LIT_ELA_POST_COMPARE_NUM,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG','Remained Off-Track/Sliding in Assessments and ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG','Moved On-Track in Both Assessments and ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG','Remained Off-Track/Sliding in Assessments, Moved On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG','Moved On-Track in Assessments, Remained Off-Track/Sliding in ELA CG',NULL)))) AS MY_LITOFF_ELAOFF_CHANGE,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',4,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG',1,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG',3,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG',2,NULL)))) AS MY_LITOFF_ELAOFF_CHANGE_NUM,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG','Moved Off-Track/Sliding in Both Assessments and ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG','Remained On-Track in Assessments and ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG','Moved Off-Track/Sliding in Assessments, Remained On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG','Remained On-Track in Assessments, Moved Off-Track/Sliding in ELA CG',NULL)))) AS MY_LITON_ELAON_CHANGE,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',4,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG',1,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG',3,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG',2,NULL)))) AS MY_LITON_ELAON_CHANGE_NUM,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG','Remained Off-Track/Sliding in Assessments, Moved Off-Track/Sliding in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG','Moved On-Track in Assessments and Remained On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG','Remained Off-Track/Sliding in Assessments, Remained On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG','Moved On-Track in Assessments, Moved Off-Track/Sliding in ELA CG',NULL)))) AS MY_LITOFF_ELAON_CHANGE,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',4,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG',1,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG',3,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG',2,NULL)))) AS MY_LITOFF_ELAON_CHANGE_NUM,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG','Moved Off-Track/Sliding in Assessments, Remained Off-Track/Sliding in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG','Remained On-Track in Assessments, Moved On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG','Moved Off-Track/Sliding in Assessments, Moved On-Track in ELA CG',IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG','Remained On-Track in Assessments, Remained Off-Track/Sliding in ELA CG',NULL)))) AS MY_LITON_ELAOFF_CHANGE,
IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in ELA CG',4,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in ELA CG',1,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in ELA CG',3,IIf(MY_LIT_ELA_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG' AND MY_LIT_ELA_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in ELA CG',2,NULL)))) AS MY_LITON_ELAOFF_CHANGE_NUM
FROM
(*****LIT PPP QUERY*****)
AS ppp_LITAssess INNER JOIN
(*****ELA CG PPP QUERY*****)
AS ppp_ELA_CG
ON (ppp_LITAssess.prepost.STUDENT_ID = ppp_ELA_CG.prepost.STUDENT_ID)
ORDER BY ppp_LITAssess.dbo_RPT_STUDENT_MAIN.SITE_NAME, ppp_LITAssess.dbo_RPT_STUDENT_MAIN.SCHOOL_NAME,ppp_LITAssess.dbo_RPT_STUDENT_MAIN.GRADE_ID,ppp_LITAssess.prepost.STUDENT_ID;

-- QUERY SYNTAX (SINGLE QUERY VERSION):

***** Not using a single query version here - too complex for now. *****