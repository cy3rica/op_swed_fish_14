-- Select all pre/post/proxy math assessment and merge with all pre/post/proxy math CG data.

-- USE THIS MODIFIED VERSION OF math CG QUERY. THIS QUERY LEAVES OUT LINKAGES TO RPT_SCHOOL_GRADE TO HELP SIMPLIFY QUERY.

SELECT prepost2.*, letterchange.LetterGradeChange_general AS MY_Change
FROM
(SELECT dbo_RPT_STUDENT_MAIN.SITE_NAME, dbo_RPT_STUDENT_MAIN.SCHOOL_NAME, dbo_RPT_STUDENT_MAIN.GRADE_ID, dbo_RPT_STUDENT_MAIN.DIPLOMAS_NOW_SCHOOL, prepost.*, MY_PROXY_MTH_CG.*,
IIf([prepost].[POST_MATH_FREQ] IS NULL AND ([prepost].[PRE_MATH_FREQ] < [MY_PROXY_MTH_CG].[INTERVAL] OR prepost.PRE_MATH_FREQ LIKE 'Math PrYr/Cumulative'),[MY_PROXY_MTH_CG].[INTERVAL],[prepost].[POST_MATH_FREQ]) AS MY_MATH_FREQ,
IIf([prepost].[POST_MATH_FREQ] IS NULL AND ([prepost].[PRE_MATH_FREQ] < [MY_PROXY_MTH_CG].[INTERVAL] OR prepost.PRE_MATH_FREQ LIKE 'Math PrYr/Cumulative'),[MY_PROXY_MTH_CG].[SCALE_LOCAL],[prepost].[POST_MATH_TRACK]) AS MY_MATH_TRACK,
IIf([prepost].[POST_MATH_FREQ] IS NULL AND ([prepost].[PRE_MATH_FREQ] < [MY_PROXY_MTH_CG].[INTERVAL] OR prepost.PRE_MATH_FREQ LIKE 'Math PrYr/Cumulative'),[MY_PROXY_MTH_CG].[CG_LETTER_VIEW],[prepost].[POST_LETTER_VIEW]) AS MY_LETTER_VIEW,
IIf([prepost].[POST_MATH_FREQ] IS NULL AND ([prepost].[PRE_MATH_FREQ] < [MY_PROXY_MTH_CG].[INTERVAL] OR prepost.PRE_MATH_FREQ LIKE 'Math PrYr/Cumulative'),[MY_PROXY_MTH_CG].[CG_LETTER_VIEW_ALL],[prepost].[POST_CG_LETTER_SCALE_ALL]) AS MY_CG_LETTER_SCALE_ALL,
IIf(prepost.PRE_LETTER_VIEW IS NOT NULL AND MY_LETTER_VIEW IS NOT NULL,prepost.PRE_LETTER_VIEW & ' to ' & MY_LETTER_VIEW,'Insufficient Data') AS MY_LETTERGRADE_CHANGE_ACTUAL,
IIf(prepost.PRE_MATH_TRACK IS NOT NULL AND MY_MATH_TRACK IS NOT NULL,[prepost].[PRE_MATH_TRACK] & " to " & MY_MATH_TRACK,"Insufficient Data") AS MY_PERF_CHANGE
FROM dbo_RPT_STUDENT_MAIN INNER JOIN (dbo_EVAL_MATH AS prepost LEFT JOIN
(SELECT allMTH1.* FROM dbo_RPT_PERFORMANCE_LEVEL AS allMTH1 LEFT JOIN dbo_RPT_PERFORMANCE_LEVEL AS allMTH2 ON (allMTH1.STUDENT_ID = allMTH2.STUDENT_ID AND allMTH1.INDICATOR_DESC = allMTH2.INDICATOR_DESC AND allMTH1.FREQ_SORT < allMTH2.FREQ_SORT AND allMTH1.SKILL_DESCRIPTION LIKE 'Math Course Grade' AND ISNULL(allMTH1.Tag)) WHERE allMTH2.STUDENT_ID IS NULL)
AS MY_PROXY_MTH_CG ON (prepost.STUDENT_ID = MY_PROXY_MTH_CG.STUDENT_ID)) ON (dbo_RPT_STUDENT_MAIN.STUDENT_ID = prepost.STUDENT_ID))
AS prepost2 LEFT JOIN dbo_RPT_LETTER_CHANGE_DEGREE AS letterchange
ON (prepost2.MY_LETTERGRADE_CHANGE_ACTUAL LIKE letterchange.LetterGrade_Change_Actual)
ORDER BY dbo_RPT_STUDENT_MAIN.SITE_NAME, dbo_RPT_STUDENT_MAIN.SCHOOL_NAME,dbo_RPT_STUDENT_MAIN.GRADE_ID,prepost.STUDENT_ID;

-- QUERY SYNTAX (BASED ON MATH CG/ASSESS QUERIES):

SELECT ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.SITE_NAME, ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.SCHOOL_NAME, ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.GRADE_ID, ppp_MTHAssess.DIPLOMAS_NOW_SCHOOL, ppp_MTHAssess.prepost.STUDENT_ID, ppp_MTHAssess.prepost.SCHOOL_ID, ppp_MTHAssess.TTL_TIME, ppp_MTHAssess.ENROLLED_DAYS, ppp_MTHAssess.ENROLLED_DAYS_CATEGORIES, ppp_MTHAssess.SITE_DOSAGE_GOAL, ppp_MTHAssess.STATUS_SITE_DOSAGE_GOAL, ppp_MTHAssess.Attendance_IA, ppp_MTHAssess.ELA_IA, ppp_MTHAssess.Math_IA, ppp_MTHAssess.Behavior_IA, ppp_MTHAssess.B_RULE_VAL1, ppp_MTHAssess.B_RULE_VAL2, ppp_MTHAssess.B_RULE_VAL3, ppp_MTHAssess.B_RULE_VAL4, ppp_MTHAssess.GRADE_ID_RECODE, ppp_MTHAssess.DN_SCHOOL_BY_GRADE, ppp_MTHAssess.MY_MET_Q3_DOSAGE, ppp_MTHAssess.MY_IN_IOG_GRADE_RANGE, ppp_MTHAssess.PRE_DATE, ppp_MTHAssess.PRE_DESC, ppp_MTHAssess.PRE_VALUE_NUM, ppp_MTHAssess.PRE_TRACK, ppp_MTHAssess.PRE_TRACK_EVAL, ppp_MTHAssess.MY_PERF_DATE, ppp_MTHAssess.MY_VALUE_NUM, ppp_MTHAssess.MY_TRACK, ppp_MTHAssess.MY_TRACK_EVAL, ppp_MTHAssess.MY_RAWCHANGE_DEGREE, ppp_MTHAssess.MY_PERFORMANCECHANGE_LOCAL, ppp_MTHAssess.MY_PERFORMANCECHANGE_NORMALIZED, ppp_MTH_CG.PRE_MATH_FREQ, ppp_MTH_CG.PRE_MATH_TRACK, ppp_MTH_CG.PRE_LETTER_VIEW, ppp_MTH_CG.PRE_CG_LETTER_SCALE_ALL, ppp_MTH_CG.MY_MATH_FREQ, ppp_MTH_CG.MY_MATH_TRACK, ppp_MTH_CG.MY_LETTER_VIEW, ppp_MTH_CG.MY_CG_LETTER_SCALE_ALL, ppp_MTH_CG.MY_LETTERGRADE_CHANGE_ACTUAL, ppp_MTH_CG.MY_Change, ppp_MTH_CG.MY_PERF_CHANGE,
IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.PRE_MATH_TRACK LIKE 'SLIDING'),'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',IIF((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'ON TRACK'),'Off-Track/Sliding in Assessments, On-Track in Math CG',IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.PRE_MATH_TRACK LIKE 'SLIDING'),'On-Track in Assessments, Off-Track/Sliding in Math CG',IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'ON TRACK'),'On-Track in Assessments, On-Track in Math CG',NULL)))) AS MY_MTHA_MTHCG_PRE_COMPARE,
IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.PRE_MATH_TRACK LIKE 'SLIDING'),4,IIF((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'ON TRACK'),3,IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.PRE_MATH_TRACK LIKE 'SLIDING'),2,IIf((ppp_MTHAssess.PRE_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.PRE_MATH_TRACK LIKE 'ON TRACK'),1,NULL)))) AS MY_MTHA_MTHCG_PRE_COMPARE_NUM,
IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.MY_MATH_TRACK LIKE 'SLIDING'),'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',IIF((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'ON TRACK'),'Off-Track/Sliding in Assessments, On-Track in Math CG',IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.MY_MATH_TRACK LIKE 'SLIDING'),'On-Track in Assessments, Off-Track/Sliding in Math CG',IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'ON TRACK'),'On-Track in Assessments, On-Track in Math CG',NULL)))) AS MY_MTHA_MTHCG_POST_COMPARE,
IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.MY_MATH_TRACK LIKE 'SLIDING'),4,IIF((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'OFF TRACK' OR ppp_MTHAssess.MY_TRACK_EVAL LIKE 'SLIDING') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'ON TRACK'),3,IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'OFF TRACK' OR ppp_MTH_CG.MY_MATH_TRACK LIKE 'SLIDING'),2,IIf((ppp_MTHAssess.MY_TRACK_EVAL LIKE 'ON TRACK') AND (ppp_MTH_CG.MY_MATH_TRACK LIKE 'ON TRACK'),1,NULL)))) AS MY_MTHA_MTHCG_POST_COMPARE_NUM,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG','Remained Off-Track/Sliding in Assessments and Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG','Moved On-Track in Both Assessments and Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG','Remained Off-Track/Sliding in Assessments, Moved On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG','Moved On-Track in Assessments, Remained Off-Track/Sliding in Math CG',NULL)))) AS MY_MTHAOFF_MTHCGOFF_CHANGE,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',4,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG',1,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG',3,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG',2,NULL)))) AS MY_MTHAOFF_MTHCGOFF_CHANGE_NUM,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG','Moved Off-Track/Sliding in Both Assessments and Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG','Remained On-Track in Assessments and Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG','Moved Off-Track/Sliding in Assessments, Remained On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG','Remained On-Track in Assessments, Moved Off-Track/Sliding in Math CG',NULL)))) AS MY_MTHAON_MTHCGON_CHANGE,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',4,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG',1,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG',3,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG',2,NULL)))) AS MY_MTHAON_MTHCGON_CHANGE_NUM,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG','Remained Off-Track/Sliding in Assessments, Moved Off-Track/Sliding in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG','Moved On-Track in Assessments and Remained On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG','Remained Off-Track/Sliding in Assessments, Remained On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG','Moved On-Track in Assessments, Moved Off-Track/Sliding in Math CG',NULL)))) AS MY_MTHAOFF_MTHCGON_CHANGE,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',4,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG',1,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG',3,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG',2,NULL)))) AS MY_MTHAOFF_MTHCGON_CHANGE_NUM,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG','Moved Off-Track/Sliding in Assessments, Remained Off-Track/Sliding in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG','Remained On-Track in Assessments, Moved On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG','Moved Off-Track/Sliding in Assessments, Moved On-Track in Math CG',IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG','Remained On-Track in Assessments, Remained Off-Track/Sliding in Math CG',NULL)))) AS MY_MTHAON_MTHCGOFF_CHANGE,
IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, Off-Track/Sliding in Math CG',4,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, On-Track in Math CG',1,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'Off-Track/Sliding in Assessments, On-Track in Math CG',3,IIf(MY_MTHA_MTHCG_PRE_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG' AND MY_MTHA_MTHCG_POST_COMPARE LIKE 'On-Track in Assessments, Off-Track/Sliding in Math CG',2,NULL)))) AS MY_MTHAON_MTHCGOFF_CHANGE_NUM
FROM
(*****MTH ASSESS PPP QUERY*****)
AS ppp_MTHAssess INNER JOIN
(*****MTH CG PPP QUERY*****)
AS ppp_MTH_CG
ON (ppp_MTHAssess.prepost.STUDENT_ID = ppp_MTH_CG.prepost.STUDENT_ID)
ORDER BY ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.SITE_NAME, ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.SCHOOL_NAME,ppp_MTHAssess.dbo_RPT_STUDENT_MAIN.GRADE_ID,ppp_MTHAssess.prepost.STUDENT_ID;

-- QUERY SYNTAX (SINGLE QUERY VERSION):

***** Not using a single query version here - too complex for now. *****